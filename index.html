<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="imagetoolbar" content="no" />

    <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='340px' height='340px' viewBox='0 0 340 340'%3E%3Cpath fill='%2388B0EA' d='M194.516,21.9687h-89.4974v223.6454h171.3087V21.9687H194.516z'/%3E%3Cpath fill='%234E73A8' d='M105.0186,21.9687c0,0-33.9699,1.6312-33.9699,41.1935v205.6682l33.9699-23.2163V21.9687z'/%3E%3Cpath fill='%23EAF5FF' d='M94.2651,245.6141c-12.822,0-23.2164,10.3943-23.2164,23.2163c0,0.2822,0.0051,0.5644,0.0154,0.8464 c0.4469,12.5806,11.1696,22.3699,23.7579,22.3699h175.6806c0.6547,0.0007,1.186-0.5294,1.1867-1.1841 c0.0005-0.4306-0.2326-0.8276-0.6088-1.037c-5.0356-2.8518-11.8872-8.9451-11.8872-20.9952 c0-19.0602,17.1297-23.2163,17.1297-23.2163H94.2651z'/%3E%3Cpath fill='%23C9D4FF' d='M259.5367,264.4277H98.5962c-2.4315,0-4.4027,1.9711-4.4027,4.4027c0,2.4315,1.9711,4.4026,4.4027,4.4026 h160.935C259.09,270.3144,259.0919,267.3458,259.5367,264.4277z'/%3E%3Crect x='110.3745' y='264.4277' fill='%23C9D4FF' width='34.1548' height='27.619'/%3E%3Cpolygon fill='%23F47676' points='120.8055,264.4277 120.8055,323.5929 144.5292,309.5672 168.2519,323.5929 168.2519,264.4277 '/%3E%3Cpath fill='%23383A49' d='M277.3642,249.8923c0.1156-0.0286,0.2118-0.0762,0.3211-0.1111c0.1416-0.0462,0.2853-0.0857,0.4201-0.1454 c1.1432-0.4827,1.8959-1.323,2.2751-2.3017c0.2246-0.5285,0.3495-1.1096,0.3495-1.72V22.425 c0.2127-2.3204-1.2181-4.8106-4.3026-4.8589H105.0186c-0.0346,0.0006-0.063,0.0097-0.0972,0.0109 c-0.0372,0.0006-0.0723-0.0081-0.1097-0.0065c-0.3819,0.0243-38.1656,2.3356-38.1656,45.5918v205.6682 c0,0.4857,0.0975,0.9444,0.2428,1.3813c0.6074,13.0155,9.7401,25.6215,27.3762,26.2378h22.1377v27.1435 c-0.0009,0.9564,0.3096,1.887,0.8847,2.6512c1.462,1.943,4.2222,2.3329,6.165,0.8709l21.08-15.8606l21.0723,15.8606 c0.7634,0.5731,1.6925,0.8822,2.6471,0.8805c2.4258-0.0139,4.3888-1.9769,4.4027-4.4027v-54.7626 c0-2.4315-1.9711-4.4026-4.4027-4.4026h-47.4464c-2.4316,0-4.4027,1.9712-4.4027,4.4026v18.8137H94.2651 c-10.3906,0-18.8137-8.4232-18.8137-18.8136c0-10.3906,8.4231-18.8137,18.8137-18.8137h167.2352 c-8.8538,9.2698-8.8615,28.3476,0,37.6273h-73.5036c-2.4315,0-4.4026,1.9712-4.4026,4.4026c0,2.4316,1.9711,4.4027,4.4026,4.4027 h88.3306c5.1676-0.0187,5.9502-7.4306,1.0633-8.6743c-6.0797-1.9632-10.8479-6.7247-12.8195-12.8016 C261.1779,264.5148,266.9055,253.2856,277.3642,249.8923z M125.2081,273.233h38.6455v41.537l-16.674-12.5476 c-0.7636-0.5727-1.6926-0.8817-2.6471-0.8805c-0.9558-0.0016-1.8861,0.3079-2.6504,0.8816l-16.674,12.5476V273.233z M94.2651,241.2114c-8.0428,0.287-14.312,3.0569-18.8137,7.2156V63.1622c0-26.6229,16.784-34.0095,25.1689-36.0402v196.2509 c0,2.4315,1.9711,4.4027,4.4027,4.4027c2.4315,0,4.4027-1.9711,4.4027-4.4027V26.3713h162.499v214.8401H94.2651z'/%3E%3C/svg%3E" />

    <title>Rezept</title>
<style>
body {
    margin: 0;
    padding: 0 5vw;
  font-style: normal;  
  font-family: 'Open Sans', sans-serif;
}
input {
  font-family: 'Open Sans';
  font-weight: 500;
}
input::placeholder {
    color: silver;
}
ul {
    padding: 0; 
    margin: 0;
}
li {
    list-style-type: none;
    padding: 0; 
    margin: 0;
}
input[type="button"] {
    margin: 0 1rem 0 0;
    font-size: 1.5rem;
    border-radius: 1.1rem;
    border: none;
    font-weight: 100;
    width: 2.2rem;
    height: 2.2rem;
    padding: 0 0 0.1rem;
}
.info {
    font-size: 1.4rem!important;
}
#recipe {
    padding: 0.5rem;
    font-size: 1rem;
    border-radius: 0.5rem;
    border: none;
    margin: 1rem 0.1rem 1rem 0;
    width: calc(100vw - 4rem);
}
.value, .unit, .ingredient {
    margin: 0 0.1rem 1rem 0;
    padding: 0.5rem;
    font-size: 1rem;
    border-radius: 0.5rem;
    border: none;
}
.value {
    width: 10%;
    min-width: 4rem;
    text-align: right;
    background-color: #eee;
}
.unit {
    width: 10%;
    min-width: 2.5rem;
    max-width: 4rem;
}
.ingredient {
    min-width: 10rem;
    width: 50%
}
.firstbreak, #break {
    margin: 0 0 1rem;
    padding: 0;
    border: 1px solid silver;
}

.calc_btn_active {
    background: no-repeat center url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='DimGray' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath d='M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z'%3E%3C/path%3E%3Cpath d='M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z'%3E%3C/path%3E%3C/svg%3E"), #F0F0F0;
}

.calc_btn_inactive {
    background: no-repeat center url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='silver' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath d='M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z'%3E%3C/path%3E%3Cpath d='M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z'%3E%3C/path%3E%3C/svg%3E"), #F0F0F0;
}

.sort_btn_active {
    background: no-repeat center url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' style='fill: none; stroke: DimGray; stroke-linecap: round;' x='0px' y='0px' width='16px' height='16px' viewBox='0 0 16 16'%3E%3Cline x1='1.5' y1='6.5' x2='14.5' y2='6.5'/%3E%3Cline x1='1.5' y1='9.5' x2='14.5' y2='9.5'/%3E%3Cline x1='8' y1='6' x2='8' y2='1'/%3E%3Cline x1='8' y1='1' x2='7' y2='2'/%3E%3Cline x1='9' y1='2' x2='8' y2='1'/%3E%3Cline x1='8' y1='10' x2='8' y2='15'/%3E%3Cline x1='8' y1='15' x2='9' y2='14'/%3E%3Cline x1='7' y1='14' x2='8' y2='15'/%3E%3C/svg%3E"), #F0F0F0;
}

.sort_btn_inactive {
    background: no-repeat center url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' style='fill: none; stroke: silver; stroke-linecap: round;' x='0px' y='0px' width='16px' height='16px' viewBox='0 0 16 16'%3E%3Cline x1='1.5' y1='6.5' x2='14.5' y2='6.5'/%3E%3Cline x1='1.5' y1='9.5' x2='14.5' y2='9.5'/%3E%3Cline x1='8' y1='6' x2='8' y2='1'/%3E%3Cline x1='8' y1='1' x2='7' y2='2'/%3E%3Cline x1='9' y1='2' x2='8' y2='1'/%3E%3Cline x1='8' y1='10' x2='8' y2='15'/%3E%3Cline x1='8' y1='15' x2='9' y2='14'/%3E%3Cline x1='7' y1='14' x2='8' y2='15'/%3E%3C/svg%3E"), #F0F0F0;
}

.entry.sortactive:before {
    background: no-repeat center url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' style='fill: none; stroke: %23B3B3B3; stroke-linecap: round;' width='16px' height='16px' viewBox='0 0 16 16'%3E%3Cline x1='1.5' y1='3.5' x2='14.5' y2='3.5'/%3E%3Cline x1='1.5' y1='7.5' x2='14.5' y2='7.5'/%3E%3Cline x1='1.5' y1='11.5' x2='14.5' y2='11.5'/%3E%3C/svg%3E");
    content: " ";
    height: 16px;
    width: 16px;
    margin:0 1rem 0 0;
    display:inline-block;
}

.dragging {
    opacity: 0.4; /* Reduziert die Sichtbarkeit, anstatt das Element auszublenden */
}

.modal {
  display: none;
  position: fixed;
  z-index: 1; 
  left: 0;
  top: 0;
  width: 100%; 
  height: 100%; 
  overflow: auto; 
  background-color: rgba(0,0,0,0.4); 
}

.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px 25px;
  border: 1px solid #888;
  width: 50%;
  border-radius: 5px;
  box-shadow: 2px 2px 10px #3336;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  margin-top: -0.5rem;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
h1 {
    margin: 0;
    padding-bottom: 0.5rem;
    font-weight: 600;
    font-size: 1.5rem;
    border-bottom: 1px solid darkgray;
}
p {
    margin: 0.5rem 0 0.5rem;
}
@media print {    
    input[type="button"], li.entry:before {
        display: none !important;
    }
    .value {
        background-color: #fff;
        margin-right:0.2rem;
    }
    .unit,.ingredient {
        margin-left:0;
        padding: 0;
    }
}
@media (max-width: 50em) { 
  h1 {
    font-size: 1rem;
  }
  p {
    font-size: 0.8rem;
}
.modal-content {
  margin: 10% auto;
  padding: 12px 15px;
  width: 80%;
}
}
</style>
</head>

<body>
    <form id="mainform">
        <input type="text" name="recipe" id="recipe" placeholder="click to edit" onchange="update_url()">
        <hr class="firstbreak">
        <div class="sortable-list">
            <ul id="sortable">
            </ul>
        </div>
    </form>
    <div id="info" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
        <h1>recipe-book</h1>
          <p>Simple html/javascript page to create your personal recipe book</p>
            
            <p>You can add values, units and the ingredients by hitting the plus buttom. All inputs are added to the URL-parameter. When you add the URL to your bookmarks you can recall the recipe. If you activate the calculator button, changing values in a saved recipe will recalculate values of the other ingredients. By activating the sorting button the sorting of the ingredients can be adjusted by dragging and dropping.</p>
            <p>Find the most recent code at <a target="_blank" href="https://github.com/zenziwerken/recipe-book">https://github.com/&#8203zenziwerken/&#8203recipe&#8209;book</a></p>
        </div>
      </div>
</body>

<script>
    const splitchar = '_';
    const touchscreen = (window.matchMedia("(pointer: coarse)").matches);

    var calc_active = false;
    var sort_active = false;

    function strip(number) {
        return Math.round(parseFloat(number) * 100) / 100;
    }

    function MycreateElement(name, value, placeholder, onchange) {
        var element = document.createElement("input");
        element.setAttribute("type", "text");
        element.setAttribute("name",  name);
        element.setAttribute("class", name);
        element.setAttribute("autocomplete", "off");
        if (value !== '') element.setAttribute("value", value);
        if (value !== '' && name == 'value') element.setAttribute("oldvalue",value);
        element.setAttribute("placeholder", placeholder);
        if (onchange == 'recalculate') element.onchange = function() { recalculate (element) }
        if (onchange == 'update_url')  element.onchange = function() { update_url () }
        
        return element;
    }

    function recalculate (element) {
        if (!calc_active || element.name === "ingredient") {
            update_url();
            return;
        }
        if (typeof element.getAttribute("oldvalue") === 'undefined' || 
            element.getAttribute("oldvalue") == 0 || 
            element.getAttribute("oldvalue") == '' ||
            element.getAttribute("oldvalue") == null) {
                if (element.value != null) element.setAttribute("oldvalue", element.value);
                return;
            }
        var factor = strip(element.value / element.getAttribute("oldvalue"));
		var form = document.getElementById("mainform");
		element.setAttribute("oldvalue", element.value);

		Array.from(form.elements).forEach((input) => {
			if (input.type === "text" && input.name === "value" && input !== element) {
                var oldval = input.getAttribute("oldvalue");
                var newval = strip(oldval * factor);
                if (newval != 0 && !isNaN(newval)) {
                    input.value = newval;
                    input.setAttribute("oldvalue", newval);
                }
			}
	    });
        update_url();
    }

    function update_url() {
		var form = document.getElementById("mainform");
		var url  = [];
		var urlparts = [];

		Array.from(form.elements).forEach((input) => {
			if (input.type === "text" && input.name !== "ingredient" && input.name !== "recipe")
				urlparts.push(encodeURIComponent(input.value));

			if (input.type === "text" && input.name === "ingredient") {
				urlparts.push(encodeURIComponent(input.value));
				url.push(urlparts.join(splitchar));
				urlparts = [];
			}
			if (input.type === "text" && input.name === "recipe") {
				url.push('recipe=' + encodeURIComponent(input.value));
				urlparts = [];
			}
	    });
        url.push('calc=' + calc_active);
        url.push('sort=' + sort_active);
		var url_new = url.filter(value => Object.keys(value).length !== 0)
		window.location = '?' + url_new.join('&');
    }

    function add_empty () {
        var li = document.createElement('li');
        li.setAttribute('draggable', 'true');
        if (sort_active) {
            li.setAttribute('class', 'entry sortactive');
        } else {
            li.setAttribute('class', 'entry');
        }
        var value = MycreateElement('value', '', 'Menge', '');
        li.appendChild(value);
        value.focus();
        li.appendChild(MycreateElement('unit', '', 'g', ''));
        li.appendChild(MycreateElement('ingredient', '', 'Zutat', 'update_url'));
        document.getElementById('sortable').appendChild(li);
    }

    function toggle_calc() {
        calc_active = !calc_active;
        var calc_class = (calc_active) ? 'calc_btn_active' : 'calc_btn_inactive';
        document.getElementById('calc_btn').setAttribute('class', calc_class);
    }

    function toggle_sort() {
        document.querySelectorAll(".entry").forEach(el => {
                el.classList.toggle("sortactive");
            });
        sort_active = !sort_active
        var sort_class = (sort_active) ? 'sort_btn_active' : 'sort_btn_inactive';
        document.getElementById('sort_btn').setAttribute('class', sort_class);
    }

    const   urlParams   = new URLSearchParams(window.location.search);
            entries     = urlParams.entries();

    if (urlParams.has("recipe")) {
        document.getElementById("recipe").setAttribute("value", urlParams.get("recipe"));
        document.title = urlParams.get("recipe");
    }

    if (urlParams.has("calc")) {
        calc_active = (urlParams.get("calc").toLowerCase() === 'true');
    }

    if (urlParams.has("sort")) {
        sort_active = (urlParams.get("sort").toLowerCase() === 'true');
        document.querySelectorAll(".entry").forEach(el => {
                el.classList.toggle("sortactive");
            });
    }

    var has_edit = false;
    var Attributes = ["recipe", "calc", "sort"];
    for (const entry of entries) {
        if ((Attributes.indexOf(entry[0].split(splitchar)[0]) > -1))  continue;
        var li = document.createElement("li");
        li.setAttribute("draggable", "true");
        if (sort_active) {
            li.setAttribute('class', 'entry sortactive');
        } else {
            li.setAttribute("class", "entry");
        }
        li.appendChild(MycreateElement('value', entry[0].split(splitchar)[0], '', 'recalculate'));
        li.appendChild(MycreateElement('unit', entry[0].split(splitchar)[1], '', ''));
        li.appendChild(MycreateElement('ingredient', entry[0].split(splitchar)[2],'Zutat', 'update_url'));
        document.getElementById("sortable").appendChild(li);
        has_edit = true;
    }

    if (!has_edit) add_empty();

    var hr = document.createElement("hr");
    hr.setAttribute("id", 'break');
    document.getElementById("mainform").append(hr);
    
    var add = document.createElement("input")
    add.setAttribute("type", "button");
    add.setAttribute("value", "+");
    add.onclick = function() {
        add_empty();
    }
    document.getElementById("mainform").append(add);

    var del = document.createElement("input")
    del.setAttribute("type", "button");
    del.setAttribute("value", "âˆ’");
    del.onclick = function() {
        var count = document.getElementsByClassName("entry");
        document.getElementsByClassName("entry")[count.length - 1].remove();
        update_url();
    }
    document.getElementById("mainform").append(del);

    var calc_class = (calc_active) ? 'calc_btn_active' : 'calc_btn_inactive';
    var calc = document.createElement("input")
    calc.setAttribute("type", "button");
    calc.setAttribute("value", " ");
    calc.setAttribute('class', calc_class);
    calc.setAttribute("id", "calc_btn");
    calc.onclick = function() {
        toggle_calc();
    }
    document.getElementById("mainform").append(calc);

    var sort_class = (sort_active) ? 'sort_btn_active' : 'sort_btn_inactive';
    var sort = document.createElement("input")
    sort.setAttribute("type", "button");
    sort.setAttribute("value", " ");
    sort.setAttribute('class', sort_class);
    sort.setAttribute("id", "sort_btn");
    sort.onclick = function() {
        toggle_sort();
    }
    document.getElementById("mainform").append(sort);

    var info = document.createElement("input")
    info.setAttribute("type", "button");
    info.setAttribute("value", "?");
    info.setAttribute('class', 'info');
    info.onclick = function() {    
        document.getElementById("info").style.display = "block";
    }
    document.getElementById("mainform").append(info);

    const sortableList = document.getElementById("sortable");
    let draggedItem = null;


    if (!touchscreen) {
        // inspired by https://www.geeksforgeeks.org/create-a-drag-and-drop-sortable-list-using-html-css-javascript/
        
        sortableList.addEventListener("dragstart", (e) => {
            if (sort_active) {
                draggedItem = e.target;
                setTimeout(() => { 
                    e.target.style.display = "none"; 
                }, 0);
            } else {
                e.preventDefault();
            }
        });
        
        sortableList.addEventListener("dragend", (e) => {
            if (sort_active) {
                setTimeout(() => {
                    e.target.style.display = "";
                    draggedItem = null;
                }, 0);
                update_url();
            }
        });

        sortableList.addEventListener("dragover", (e) => {
            if (sort_active) {
                e.preventDefault();
                const afterElement =
                    getDragAfterElement(sortableList, e.clientY);
                const currentElement =
                    document.querySelector(
                        ".dragging");
                if (afterElement == null) {
                    sortableList.appendChild(draggedItem);
                } else {
                    sortableList.insertBefore(draggedItem,afterElement);
                }
            }
            });
            
    } else {
        let touchStartY = 0;

        // Touch event handlers
        sortableList.addEventListener("touchstart", (e) => {
            if (e.target.tagName.toLowerCase() === "li") {
                draggedItem = e.target;
                touchStartY = e.touches[0].clientY;
                setTimeout(() => {
                    draggedItem.classList.add("dragging");
                }, 0);
            }
        });

        sortableList.addEventListener("touchmove", (e) => {
            e.preventDefault();
            const touchY = e.touches[0].clientY;
            const afterElement = getDragAfterElement(sortableList, touchY);
            if (afterElement == null) {
                sortableList.appendChild(draggedItem);
            } else {
                sortableList.insertBefore(draggedItem, afterElement);
            }
        });

        sortableList.addEventListener("touchend", (e) => {
            if (draggedItem) {
                setTimeout(() => {
                    draggedItem.classList.remove("dragging");
                    draggedItem = null;
                }, 0);
                update_url();
            }
        });
    }

    const getDragAfterElement = (container, y) => {
            const draggableElements = [...container.querySelectorAll("li:not(.dragging)")];

            return draggableElements.reduce(
                (closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                },
                { offset: Number.NEGATIVE_INFINITY }
            ).element;
        };
        
var modal = document.getElementById("info");
var btn   = document.getElementById("infobtn");
var span  = document.getElementsByClassName("close")[0];

span.onclick = function() {
    modal.style.display = "none";  
}
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";  
  }
}
</script>
</html>